<!DOCTYPE html>
<html lang="ar">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>سجل المربين</title>
  <link rel="stylesheet" href="style.css">
  <style>
    /* بعض التنسيقات الأساسية */
    body {
      font-family: Arial, sans-serif;
      background-color: #f0f4f8;
      color: #333;
      text-align: center;
      margin: 0;
      padding: 0;
    }
    .container {
      max-width: 600px;
      margin: auto;
      padding: 20px;
      background-color: #ffffff;
      border-radius: 10px;
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
      margin-top: 30px;
    }
    .hidden { display: none; }
    /* زر القائمة الرئيسي */
    .menu-btn {
      background-color: #009688;
      color: white;
      padding: 10px;
      border: none;
      cursor: pointer;
      width: 100%;
      font-size: 16px;
      border-radius: 5px;
      transition: background-color 0.3s ease, transform 0.3s ease;
    }
    .menu-btn:hover {
      background-color: #00796b;
      transform: scale(1.02);
    }
    /* قائمة التنقل */
    .menu {
      position: absolute;
      top: 10px;
      right: 10px;
      left: auto;
      display: none;
      background-color: #ffffff;
      border-radius: 10px;
      box-shadow: 0 4px 8px rgba(0,0,0,0.1);
      padding: 20px;
      width: 200px;
      z-index: 1000;
    }
    .menu.show {
      display: block;
      animation: slideIn 0.5s forwards;
    }
    .menu .menu-btn {
      display: block;
      margin-bottom: 10px;
    }
    .record {
      background-color: #f9f9f9;
      padding: 12px;
      margin: 10px 0;
      border-radius: 8px;
      cursor: pointer;
      position: relative;
      border: 1px solid #ddd;
      transition: background-color 0.3s ease;
    }
    .record:hover { background-color: #f1f1f1; }
    .edit-btn, .delete-btn, .hide-btn, .details-btn {
      background-color: #FFC107;
      color: white;
      padding: 6px 12px;
      border: none;
      cursor: pointer;
      margin-left: 5px;
      border-radius: 5px;
    }
    .delete-btn { background-color: #E91E63; }
    .hide-btn { background-color: #FF5722; }
    input[type="text"],
    input[type="password"],
    input[type="email"],
    input[type="datetime-local"],
    input[type="date"],
    select {
      padding: 10px;
      width: 100%;
      margin: 10px 0;
      border-radius: 5px;
      border: 1px solid #ccc;
      box-sizing: border-box;
    }
    .custom-date {
      border: 2px solid #009688;
      background-color: #e0f2f1;
      color: #333;
    }
    /* تأثير إسقاط كلمة الترحيب */
    #welcome { animation: dropDown 1.5s ease-out; }
    @keyframes dropDown {
      from { transform: translateY(-50px); opacity: 0; }
      to { transform: translateY(0); opacity: 1; }
    }
    @keyframes slideIn {
      from { transform: translateX(100%); opacity: 0; }
      to { transform: translateX(0); opacity: 1; }
    }
    /* تنسيق الإشعارات */
    .notification {
      position: fixed;
      top: 20px;
      left: 50%;
      transform: translateX(-50%);
      padding: 15px 20px;
      border: 2px solid;
      border-radius: 8px;
      display: flex;
      align-items: center;
      z-index: 2000;
      animation: shake 0.5s ease-in-out;
      min-width: 300px;
    }
    .notification.success {
      background-color: rgba(0,128,0,0.3);
      border-color: #008000;
    }
    .notification.error {
      background-color: rgba(255,0,0,0.3);
      border-color: #FF0000;
    }
    .notification .circle {
      width: 30px;
      height: 30px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      font-weight: bold;
      flex-shrink: 0;
    }
    .notification.success .circle { background-color: #008000; margin-left: 15px; }
    .notification.error .circle { background-color: #FF0000; margin-right: 15px; }
    .notification .progress {
      position: absolute;
      bottom: 0;
      left: 0;
      height: 4px;
      background-color: currentColor;
      width: 100%;
      animation: progressShrink 3s linear forwards;
      border-bottom-left-radius: 6px;
      border-bottom-right-radius: 6px;
    }
    @keyframes progressShrink { from { width: 100%; } to { width: 0; } }
    @keyframes fadeOut { from { opacity: 1; } to { opacity: 0; } }
    @keyframes tilt {
      0% { transform: rotate(0deg); }
      25% { transform: rotate(5deg); }
      50% { transform: rotate(0); }
      75% { transform: rotate(-5deg); }
      100% { transform: rotate(0); }
    }
    @keyframes shake {
      0% { transform: translateX(-50%) rotate(0deg); }
      25% { transform: translateX(-50%) rotate(3deg); }
      50% { transform: translateX(-50%) rotate(0deg); }
      75% { transform: translateX(-50%) rotate(-3deg); }
      100% { transform: translateX(-50%) rotate(0deg); }
    }
  </style>
</head>
<body>

  <!-- زر القائمة -->
  <button class="menu-btn" onclick="toggleMenu()">☰ القائمة</button>

  <!-- القائمة الجانبية -->
  <div id="menu" class="menu">
    <button class="menu-btn" onclick="showSection('main')">القائمة الرئيسية</button>
    <button class="menu-btn" onclick="showSection('breeders')">سجل المربين</button>
    <button class="menu-btn" onclick="showSection('resetPassword')">إعادة تعيين كلمة المرور</button>
    <!-- يظهر زر لوحة التحكم الإدارية للحساب المالك أو لأي حساب بريده الإلكتروني thepro332211yt@gmail.com -->
    <button id="adminPanelBtn" class="menu-btn hidden" onclick="showSection('adminPanel')">لوحة التحكم الإدارية</button>
    <button class="menu-btn" onclick="logout()">تسجيل خروج</button>
  </div>

  <!-- صفحة تسجيل الدخول -->
  <div id="login" class="container hidden">
    <h2>تسجيل الدخول</h2>
    <input type="text" id="loginUsername" placeholder="اسم المستخدم">
    <input type="password" id="loginPassword" placeholder="كلمة المرور">
    <button class="menu-btn" onclick="loginUser()">تسجيل الدخول</button>
    <p style="margin-top:15px;">
      <span style="color:#fff; background-color:#333; padding:5px 10px; border-radius:5px;">
        ليس لديك حساب؟ <a onclick="showSection('register')">اضغط هنا للإنشاء</a>
      </span>
    </p>
    <p style="margin-top:15px;">
      <a onclick="showSection('resetPassword')">نسيت كلمة المرور؟</a>
    </p>
  </div>

  <!-- صفحة إنشاء الحساب -->
  <div id="register" class="container hidden">
    <h2>إنشاء حساب</h2>
    <input type="text" id="registerUsername" placeholder="اسم المستخدم">
    <input type="email" id="registerEmail" placeholder="البريد الإلكتروني">
    <input type="password" id="registerPassword" placeholder="كلمة المرور">
    <input type="password" id="registerConfirmPassword" placeholder="تأكيد كلمة المرور">
    <button class="menu-btn" onclick="registerUser()">إنشاء حساب</button>
    <p style="margin-top:15px;">
      <span style="color:#fff; background-color:#333; padding:5px 10px; border-radius:5px;">
        هل لديك حساب؟ <a onclick="showSection('login')">اضغط هنا لتسجيل الدخول</a>
      </span>
    </p>
  </div>

  <!-- صفحة إعادة تعيين كلمة المرور -->
  <div id="resetPassword" class="container hidden">
    <h2>إعادة تعيين كلمة المرور</h2>
    <input type="text" id="resetUsername" placeholder="اسم المستخدم">
    <input type="email" id="resetEmail" placeholder="البريد الإلكتروني">
    <input type="password" id="resetNewPassword" placeholder="كلمة المرور الجديدة">
    <input type="password" id="resetConfirmPassword" placeholder="تأكيد كلمة المرور الجديدة">
    <button class="menu-btn" onclick="resetPassword()">إعادة تعيين كلمة المرور</button>
    <p style="margin-top:15px;">
      <span style="color:#fff; background-color:#333; padding:5px 10px; border-radius:5px;">
        لديك حساب؟ <a onclick="showSection('login')">اضغط هنا لتسجيل الدخول</a>
      </span>
    </p>
  </div>

  <!-- الصفحة الرئيسية بعد تسجيل الدخول -->
  <div id="main" class="container hidden">
    <h2 id="welcome">أهلا بك</h2>
    <!-- الحقول الأساسية -->
    <input type="text" id="breederName" placeholder="اسم المربي">
    <input type="text" id="breederPhone" placeholder="رقم جوال المربي">
    <input type="text" id="breederLocation" placeholder="الموقع">
    <!-- اختيار نوع العمل الميداني -->
    <select id="fieldWorkType" onchange="handleFieldWorkChange()">
      <option value="">اختر نوع العمل الميداني</option>
      <option value="تحصين">تحصين</option>
      <option value="تشخيص">تشخيص</option>
      <option value="ولادة">ولادة</option>
      <option value="جراحة">جراحة</option>
    </select>
    
    <!-- قسم تحصين -->
    <div id="section_vaccination" class="hidden">
      <select id="vaccination_vaccineType">
        <option value="">اختر نوع التطعيم</option>
        <option value="معوي">معوي</option>
        <option value="دموي">دموي</option>
        <option value="مزدوج">مزدوج</option>
        <option value="طاعون">طاعون</option>
        <option value="بروسيلا">بروسيلا</option>
        <option value="جدري">جدري</option>
        <option value="قلاعية">قلاعية</option>
      </select>
      <br>
      <label>تاريخ التحصين:</label>
      <input type="datetime-local" id="vaccination_date">
      <br>
      <label>الموعد القادم:</label>
      <input type="datetime-local" id="vaccination_nextAppointment">
    </div>
    
    <!-- قسم تشخيص -->
    <div id="section_diagnosis" class="hidden">
      <input type="text" id="diagnosis_diseaseType" placeholder="نوع المرض">
      <input type="text" id="diagnosis_treatment" placeholder="نوع العلاج">
      <br>
      <label>تاريخ التشخيص:</label>
      <input type="datetime-local" id="diagnosis_date">
      <br>
      <label>الموعد القادم:</label>
      <input type="datetime-local" id="diagnosis_nextAppointment">
    </div>
    
    <!-- قسم ولادة -->
    <div id="section_delivery" class="hidden">
      <select id="delivery_animalType">
        <option value="">اختر نوع الحيوان</option>
        <option value="إبل">إبل</option>
        <option value="بقر">بقر</option>
        <option value="ماعز">ماعز</option>
        <option value="ضان">ضان</option>
      </select>
      <br>
      <label>تاريخ الولادة:</label>
      <input type="datetime-local" id="delivery_date">
      <br>
      <select id="delivery_type">
        <option value="">اختر نوع الولادة</option>
        <option value="ولادة طبيعية">ولادة طبيعية</option>
        <option value="ولادة قيصرية">ولادة قيصرية</option>
      </select>
      <br>
      <input type="text" id="delivery_treatment" placeholder="العلاج">
      <br>
      <label>الموعد القادم:</label>
      <input type="datetime-local" id="delivery_nextAppointment">
    </div>
    
    <!-- قسم جراحة -->
    <div id="section_surgery" class="hidden">
      <input type="text" id="surgery_type" placeholder="نوع الجراحة">
      <input type="text" id="surgery_treatment" placeholder="العلاج">
      <br>
      <label>تاريخ الجراحة:</label>
      <input type="datetime-local" id="surgery_date">
      <br>
      <label>الموعد القادم:</label>
      <input type="datetime-local" id="surgery_nextAppointment">
    </div>
    
    <!-- قسم المواعيد السابقة (اختياري) -->
    <div id="previousAppointmentsSection">
      <h3>المواعيد السابقة (اختياري)</h3>
      <div id="previousAppointmentsContainer"></div>
      <button type="button" class="menu-btn" onclick="addPreviousAppointmentField()">أضف موعد سابق</button>
    </div>
    <br>
    <button class="menu-btn" onclick="addBreeder()">اضغط للإرسال</button>
  </div>

  <!-- صفحة سجل المربين -->
  <div id="breeders" class="container hidden">
    <h2>سجل المربين</h2>
    <input type="text" id="search" oninput="searchBreeders()" placeholder="بحث في السجل">
    <br><br>
    <div id="records-list"></div>
  </div>

  <!-- صفحة تفاصيل المربي -->
  <div id="breederDetail" class="container hidden">
    <h2>تفاصيل المربي</h2>
    <p id="detailName"></p>
    <p id="detailPhone"></p>
    <p id="detailLocation"></p>
    <p id="detailFieldWork"></p>
    <div id="detailExtra"></div>
    <h3>المواعيد السابقة:</h3>
    <div id="detailPreviousAppointments"></div>
    <br>
    <button class="menu-btn" onclick="showSection('breeders')">عودة إلى سجل المربين</button>
  </div>

  <!-- صفحة لوحة التحكم الإدارية -->
  <div id="adminPanel" class="container hidden">
    <h2>لوحة التحكم الإدارية</h2>
    <div id="accounts-list"></div>
  </div>

  <script>
    let breeders = [];
    let detailInterval; // متغير لتحديث العد التنازلي في صفحة تفاصيل المربي
    
    // إنشاء حساب المالك "محمد بن علي" إذا لم يكن موجودًا مسبقًا
    if (!localStorage.getItem("account_owner")) {
      let ownerAccount = {
        username: "محمد بن علي",
        email: "owner@example.com",
        password: "ownerpass",
        createdAt: new Date().toISOString()
      };
      localStorage.setItem("account_owner", JSON.stringify(ownerAccount));
    }
    // إنشاء حساب المسؤول "admin" كما في السابق
    if (!localStorage.getItem("account_admin")) {
      let adminAccount = {
        username: "admin",
        email: "admin@example.com",
        password: "09090808",
        createdAt: new Date().toISOString()
      };
      localStorage.setItem("account_admin", JSON.stringify(adminAccount));
    }

    function toggleMenu() {
      let menu = document.getElementById("menu");
      menu.classList.toggle("show");
    }

    function showSection(section) {
      // عند تغيير الصفحة يتم إيقاف تحديث العد التنازلي إن وجد
      if(detailInterval) {
        clearInterval(detailInterval);
        detailInterval = null;
      }
      const sections = ["login", "register", "main", "breeders", "resetPassword", "adminPanel", "breederDetail"];
      sections.forEach(s => {
        document.getElementById(s).classList.add("hidden");
      });
      // السماح بدخول لوحة التحكم الإدارية للحساب المالك "محمد بن علي" أو لأي حساب بريده الإلكتروني thepro332211yt@gmail.com
      if (section === "adminPanel") {
         let username = localStorage.getItem("username");
         let allowed = false;
         if (username === "محمد بن علي") {
           allowed = true;
         } else {
           let accountData = (username && username.toLowerCase() === "admin") ? localStorage.getItem("account_admin") : localStorage.getItem("account_" + username);
           if (accountData) {
             let account = JSON.parse(accountData);
             if (account.email === "thepro332211yt@gmail.com") {
               allowed = true;
             }
           }
         }
         if (!allowed) {
           alert("غير مصرح");
           return;
         }
      }
      document.getElementById(section).classList.remove("hidden");
      document.getElementById("menu").classList.remove("show");
      if (section === "breeders") { showBreeders(); }
      if (section === "adminPanel") { showAdminPanel(); }
    }

    function updateWelcome() {
      let username = localStorage.getItem("username");
      document.getElementById("welcome").innerText = "أهلا بك يا " + username;
      // اظهار زر لوحة التحكم الإدارية للحساب المالك أو للحساب الذي بريده thepro332211yt@gmail.com
      if (username === "محمد بن علي") {
        document.getElementById("adminPanelBtn").classList.remove("hidden");
      } else {
        // تحقق من البريد الإلكتروني للحساب
        let accountData = (username && username.toLowerCase() === "admin") ? localStorage.getItem("account_admin") : localStorage.getItem("account_" + username);
        if (accountData) {
          let account = JSON.parse(accountData);
          if (account.email === "thepro332211yt@gmail.com") {
            document.getElementById("adminPanelBtn").classList.remove("hidden");
          } else {
            document.getElementById("adminPanelBtn").classList.add("hidden");
          }
        } else {
          document.getElementById("adminPanelBtn").classList.add("hidden");
        }
      }
    }

    function loginUser() {
      let username = document.getElementById("loginUsername").value;
      let password = document.getElementById("loginPassword").value;
      let accountData;
      if (username === "محمد بن علي") {
        accountData = localStorage.getItem("account_owner");
      } else if (username.toLowerCase() === "admin") {
        accountData = localStorage.getItem("account_admin");
      } else {
        accountData = localStorage.getItem("account_" + username);
      }
      if (accountData) {
        let account = JSON.parse(accountData);
        if (username === account.username && password === account.password) {
          if (account.banned) {
            alert("تم تبنديك بواسطة المالك السبب: " + account.banReason);
            return;
          }
          localStorage.setItem("username", username);
          breeders = JSON.parse(localStorage.getItem("breeders_" + username)) || [];
          updateWelcome();
          showSection("main");
        } else {
          alert("اسم المستخدم أو كلمة المرور غير صحيحة");
        }
      } else {
        alert("الحساب غير موجود. الرجاء إنشاء حساب.");
      }
    }

    function registerUser() {
      let username = document.getElementById("registerUsername").value;
      let email = document.getElementById("registerEmail").value;
      let password = document.getElementById("registerPassword").value;
      let confirmPassword = document.getElementById("registerConfirmPassword").value;
      
      // منع التسجيل باسم الحساب المالك "محمد بن علي"
      if (username === "محمد بن علي") {
        alert("اسم المستخدم محمد بن علي محجوز");
        return;
      }
      if (username.toLowerCase() === "admin") {
        alert("اسم المستخدم admin محجوز");
        return;
      }
      if (!email) {
        alert("يرجى إدخال البريد الإلكتروني");
        return;
      }
      if (password !== confirmPassword) {
        alert("كلمة المرور وتأكيدها غير متطابقين");
        return;
      }
      if (localStorage.getItem("account_" + username)) {
        alert("اسم المستخدم موجود بالفعل");
        return;
      }
      let account = {
        username,
        email,
        password,
        createdAt: new Date().toISOString()
      };
      localStorage.setItem("account_" + username, JSON.stringify(account));
      localStorage.setItem("username", username);
      breeders = JSON.parse(localStorage.getItem("breeders_" + username)) || [];
      updateWelcome();
      showSection("main");
    }

    function resetPassword() {
      let username = document.getElementById("resetUsername").value;
      let email = document.getElementById("resetEmail").value;
      let newPassword = document.getElementById("resetNewPassword").value;
      let confirmPassword = document.getElementById("resetConfirmPassword").value;
      
      if (newPassword !== confirmPassword) {
        alert("كلمة المرور وتأكيدها غير متطابقين");
        return;
      }
      let accountData;
      if (username === "محمد بن علي") {
        accountData = localStorage.getItem("account_owner");
      } else {
        accountData = localStorage.getItem("account_" + username);
      }
      if (!accountData) {
        alert("الحساب غير موجود");
        return;
      }
      let account = JSON.parse(accountData);
      if (account.email !== email) {
        alert("الايميل أو اسم المستخدم غير صالح");
        return;
      }
      account.password = newPassword;
      if (username === "محمد بن علي") {
        localStorage.setItem("account_owner", JSON.stringify(account));
      } else {
        localStorage.setItem("account_" + username, JSON.stringify(account));
      }
      alert("تم إعادة تعيين كلمة المرور بنجاح");
      showSection("login");
    }

    function handleFieldWorkChange() {
      let type = document.getElementById("fieldWorkType").value;
      // إخفاء جميع الأقسام الإضافية
      document.getElementById("section_vaccination").classList.add("hidden");
      document.getElementById("section_diagnosis").classList.add("hidden");
      document.getElementById("section_delivery").classList.add("hidden");
      document.getElementById("section_surgery").classList.add("hidden");
      if (type === "تحصين") {
        document.getElementById("section_vaccination").classList.remove("hidden");
      } else if (type === "تشخيص") {
        document.getElementById("section_diagnosis").classList.remove("hidden");
      } else if (type === "ولادة") {
        document.getElementById("section_delivery").classList.remove("hidden");
      } else if (type === "جراحة") {
        document.getElementById("section_surgery").classList.remove("hidden");
      }
    }

    function addPreviousAppointmentField() {
      const container = document.getElementById("previousAppointmentsContainer");
      const div = document.createElement("div");
      div.className = "prev-app";
      div.style.marginBottom = "10px";
      const dateInput = document.createElement("input");
      dateInput.type = "date";
      dateInput.placeholder = "اختر تاريخ الموعد";
      dateInput.style.width = "45%";
      const vaccineSelect = document.createElement("select");
      vaccineSelect.style.width = "45%";
      vaccineSelect.style.marginLeft = "10px";
      vaccineSelect.innerHTML = `
        <option value="">اختر نوع التطعيم</option>
        <option value="معوي">معوي</option>
        <option value="دموي">دموي</option>
        <option value="مزدوج">مزدوج</option>
        <option value="طاعون">طاعون</option>
        <option value="جدري">جدري</option>
        <option value="قلاعية">قلاعية</option>
      `;
      div.appendChild(dateInput);
      div.appendChild(vaccineSelect);
      container.appendChild(div);
    }

    // دالة عرض الإشعارات
    function showNotification(msg, type = "success") {
      let notification = document.createElement("div");
      notification.className = "notification " + type;
      if (type === "success") {
        let textSpan = document.createElement("span");
        textSpan.innerText = msg;
        notification.appendChild(textSpan);
        let circle = document.createElement("div");
        circle.className = "circle";
        circle.innerText = "✓";
        notification.appendChild(circle);
      } else if (type === "error") {
        let circle = document.createElement("div");
        circle.className = "circle";
        circle.innerText = "×";
        notification.appendChild(circle);
        let textSpan = document.createElement("span");
        textSpan.innerText = msg;
        notification.appendChild(textSpan);
      }
      let progress = document.createElement("div");
      progress.className = "progress";
      notification.appendChild(progress);
      document.body.appendChild(notification);
      setTimeout(() => {
        notification.style.animation = "fadeOut 2s forwards";
        setTimeout(() => { notification.remove(); }, 2000);
      }, 3000);
    }

    function addBreeder() {
      let name = document.getElementById("breederName").value;
      let phone = document.getElementById("breederPhone").value;
      let location = document.getElementById("breederLocation").value;
      let fieldWorkType = document.getElementById("fieldWorkType").value;
      
      // التأكد من تعبئة الحقول الأساسية
      if (!name || !phone || !location || !fieldWorkType) {
        showNotification("يرجى تعبئة الحقول الأساسية!", "error");
        return;
      }
      
      // بناء كائن السجل الأساسي
      let record = { name, phone, location, fieldWorkType, previousAppointments: [] };
      
      // جمع بيانات المواعيد السابقة إن وُجدت
      let prevContainer = document.getElementById("previousAppointmentsContainer");
      let prevNodes = prevContainer.querySelectorAll(".prev-app");
      prevNodes.forEach(div => {
        let dateVal = div.querySelector("input[type='date']").value;
        let vaccineVal = div.querySelector("select").value;
        // إذا كانت قيمة التاريخ غير فارغة نضيفها
        if (dateVal) {
          record.previousAppointments.push({ date: dateVal, vaccine: vaccineVal });
        }
      });
      
      // معالجة كل قسم بناءً على نوع العمل الميداني
      if (fieldWorkType === "تحصين") {
        let vaccineType = document.getElementById("vaccination_vaccineType").value;
        let vaccDate = document.getElementById("vaccination_date").value;
        let vaccNext = document.getElementById("vaccination_nextAppointment").value;
        if (!vaccineType || !vaccDate || !vaccNext) {
          showNotification("يرجى تعبئة بيانات التحصين كاملة!", "error");
          return;
        }
        record.details = {
          vaccineType: vaccineType,
          vaccinationDate: vaccDate,
          nextAppointment: vaccNext
        };
        breeders.push(record);
      }
      else if (fieldWorkType === "تشخيص") {
        let diseaseType = document.getElementById("diagnosis_diseaseType").value;
        let treatment = document.getElementById("diagnosis_treatment").value;
        let diagDate = document.getElementById("diagnosis_date").value;
        let diagNext = document.getElementById("diagnosis_nextAppointment").value;
        if (!diseaseType || !treatment || !diagDate || !diagNext) {
          showNotification("يرجى تعبئة بيانات التشخيص كاملة!", "error");
          return;
        }
        record.details = {
          diseaseType: diseaseType,
          treatment: treatment,
          diagnosisDate: diagDate,
          nextAppointment: diagNext
        };
        breeders.push(record);
      }
      else if (fieldWorkType === "ولادة") {
        let animalType = document.getElementById("delivery_animalType").value;
        let deliveryDate = document.getElementById("delivery_date").value;
        let deliveryType = document.getElementById("delivery_type").value;
        let deliveryTreatment = document.getElementById("delivery_treatment").value;
        let deliveryNext = document.getElementById("delivery_nextAppointment").value;
        if (!animalType || !deliveryDate || !deliveryType || !deliveryTreatment || !deliveryNext) {
          showNotification("يرجى تعبئة بيانات الولادة كاملة!", "error");
          return;
        }
        record.details = {
          animalType: animalType,
          deliveryDate: deliveryDate,
          deliveryType: deliveryType,
          treatment: deliveryTreatment,
          nextAppointment: deliveryNext
        };
        breeders.push(record);
      }
      else if (fieldWorkType === "جراحة") {
        let surgeryType = document.getElementById("surgery_type").value;
        let surgeryTreatment = document.getElementById("surgery_treatment").value;
        let surgeryDate = document.getElementById("surgery_date").value;
        let surgeryNext = document.getElementById("surgery_nextAppointment").value;
        if (!surgeryType || !surgeryTreatment || !surgeryDate || !surgeryNext) {
          showNotification("يرجى تعبئة بيانات الجراحة كاملة!", "error");
          return;
        }
        // بحسب الطلب بيانات الجراحة لا تُضاف إلى سجل المربين
        showNotification("تم الإرسال بنجاح!", "success");
        clearMainFields();
        return;
      }
      else {
        showNotification("نوع العمل الميداني غير معروف!", "error");
        return;
      }
      
      localStorage.setItem("breeders_" + localStorage.getItem("username"), JSON.stringify(breeders));
      showNotification("تم الإرسال بنجاح!", "success");
      clearMainFields();
      showBreeders();
    }

    function clearMainFields() {
      document.getElementById("breederName").value = "";
      document.getElementById("breederPhone").value = "";
      document.getElementById("breederLocation").value = "";
      document.getElementById("fieldWorkType").selectedIndex = 0;
      
      // تنظيف أقسام العمل الميداني
      document.getElementById("section_vaccination").classList.add("hidden");
      document.getElementById("vaccination_vaccineType").selectedIndex = 0;
      document.getElementById("vaccination_date").value = "";
      document.getElementById("vaccination_nextAppointment").value = "";
      
      document.getElementById("section_diagnosis").classList.add("hidden");
      document.getElementById("diagnosis_diseaseType").value = "";
      document.getElementById("diagnosis_treatment").value = "";
      document.getElementById("diagnosis_date").value = "";
      document.getElementById("diagnosis_nextAppointment").value = "";
      
      document.getElementById("section_delivery").classList.add("hidden");
      document.getElementById("delivery_animalType").selectedIndex = 0;
      document.getElementById("delivery_date").value = "";
      document.getElementById("delivery_type").selectedIndex = 0;
      document.getElementById("delivery_treatment").value = "";
      document.getElementById("delivery_nextAppointment").value = "";
      
      document.getElementById("section_surgery").classList.add("hidden");
      document.getElementById("surgery_type").value = "";
      document.getElementById("surgery_treatment").value = "";
      document.getElementById("surgery_date").value = "";
      document.getElementById("surgery_nextAppointment").value = "";
      
      // تنظيف قسم المواعيد السابقة
      document.getElementById("previousAppointmentsContainer").innerHTML = "";
    }

    // دالة لحساب الوقت المتبقي بالأيام والساعات (عرض القائمة)
    function calculateRemainingTime(date) {
      if (!date) return "";
      let diff = new Date(date) - new Date();
      let sign = diff < 0 ? "-" : "";
      diff = Math.abs(diff);
      let days = Math.floor(diff / (1000 * 60 * 60 * 24));
      let hours = Math.floor((diff % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
      return sign + days + " يوم و " + hours + " ساعة";
    }

    // دالة لحساب الوقت المتبقي بالتفصيل (الأيام والساعات والدقائق والثواني)
    function calculateRemainingTimeDetailed(date) {
      if (!date) return "";
      let diff = new Date(date) - new Date();
      let sign = diff < 0 ? "-" : "";
      diff = Math.abs(diff);
      let days = Math.floor(diff / (1000 * 60 * 60 * 24));
      let hours = Math.floor((diff % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
      let minutes = Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60));
      let seconds = Math.floor((diff % (1000 * 60)) / 1000);
      return sign + days + " يوم و " + hours + " ساعة و " + minutes + " دقيقة و " + seconds + " ثانية";
    }

    function showBreeders() {
      let recordsList = document.getElementById("records-list");
      recordsList.innerHTML = "";
      breeders.forEach((breeder, index) => {
        let nextApp = (breeder.details && breeder.details.nextAppointment) ? breeder.details.nextAppointment : "";
        let remainingTime = nextApp ? calculateRemainingTime(nextApp) : "";
        let recordDiv = document.createElement("div");
        recordDiv.className = "record";
        recordDiv.innerHTML = `
          ${breeder.name} - النوع: ${breeder.fieldWorkType} - الموعد القادم: ${remainingTime}
          <button class="edit-btn" onclick="editBreeder(${index}); event.stopPropagation();">تعديل</button>
          <button class="delete-btn" onclick="deleteBreeder(${index}); event.stopPropagation();">حذف</button>
        `;
        recordDiv.onclick = function() {
          showBreederDetail(index);
        };
        recordsList.appendChild(recordDiv);
      });
    }

    function showBreederDetail(index) {
      let breeder = breeders[index];
      document.getElementById("detailName").innerText = "اسم المربي: " + breeder.name;
      document.getElementById("detailPhone").innerText = "رقم الجوال: " + breeder.phone;
      document.getElementById("detailLocation").innerText = "الموقع: " + breeder.location;
      document.getElementById("detailFieldWork").innerText = "نوع العمل الميداني: " + breeder.fieldWorkType;
      let detailExtra = document.getElementById("detailExtra");
      detailExtra.innerHTML = "";
      if (breeder.details) {
        if (breeder.fieldWorkType === "تحصين") {
          detailExtra.innerHTML = `
            <p>نوع التطعيم: ${breeder.details.vaccineType}</p>
            <p>تاريخ التحصين: ${breeder.details.vaccinationDate}</p>
            <p>الموعد القادم: <span id="detailedCountdown">${calculateRemainingTimeDetailed(breeder.details.nextAppointment)}</span></p>
          `;
        } else if (breeder.fieldWorkType === "تشخيص") {
          detailExtra.innerHTML = `
            <p>نوع المرض: ${breeder.details.diseaseType}</p>
            <p>نوع العلاج: ${breeder.details.treatment}</p>
            <p>تاريخ التشخيص: ${breeder.details.diagnosisDate}</p>
            <p>الموعد القادم: <span id="detailedCountdown">${calculateRemainingTimeDetailed(breeder.details.nextAppointment)}</span></p>
          `;
        } else if (breeder.fieldWorkType === "ولادة") {
          detailExtra.innerHTML = `
            <p>نوع الحيوان: ${breeder.details.animalType}</p>
            <p>تاريخ الولادة: ${breeder.details.deliveryDate}</p>
            <p>نوع الولادة: ${breeder.details.deliveryType}</p>
            <p>العلاج: ${breeder.details.treatment}</p>
            <p>الموعد القادم: <span id="detailedCountdown">${calculateRemainingTimeDetailed(breeder.details.nextAppointment)}</span></p>
          `;
        }
      }
      let detailPrev = document.getElementById("detailPreviousAppointments");
      detailPrev.innerHTML = "";
      if (breeder.previousAppointments && breeder.previousAppointments.length > 0) {
        breeder.previousAppointments.forEach(app => {
          let p = document.createElement("p");
          p.innerText = app.date + " - " + app.vaccine;
          detailPrev.appendChild(p);
        });
      } else {
        detailPrev.innerText = "لا يوجد";
      }
      showSection("breederDetail");

      // تحديث العد التنازلي بالتفصيل كل ثانية
      if (breeder.details && breeder.details.nextAppointment) {
        detailInterval = setInterval(function() {
          let countdownElement = document.getElementById("detailedCountdown");
          if (countdownElement) {
            countdownElement.innerText = calculateRemainingTimeDetailed(breeder.details.nextAppointment);
          }
        }, 1000);
      }
    }

    function deleteBreeder(index) {
      if (confirm("هل أنت متأكد من حذف هذا السجل؟")) {
        breeders.splice(index, 1);
        localStorage.setItem("breeders_" + localStorage.getItem("username"), JSON.stringify(breeders));
        showBreeders();
      }
    }

    function editBreeder(index) {
      let breeder = breeders[index];
      document.getElementById("breederName").value = breeder.name;
      document.getElementById("breederPhone").value = breeder.phone;
      document.getElementById("breederLocation").value = breeder.location;
      document.getElementById("fieldWorkType").value = breeder.fieldWorkType;
      handleFieldWorkChange();
      if (breeder.fieldWorkType === "تحصين" && breeder.details) {
        document.getElementById("vaccination_vaccineType").value = breeder.details.vaccineType;
        document.getElementById("vaccination_date").value = breeder.details.vaccinationDate;
        document.getElementById("vaccination_nextAppointment").value = breeder.details.nextAppointment;
      }
      else if (breeder.fieldWorkType === "تشخيص" && breeder.details) {
        document.getElementById("diagnosis_diseaseType").value = breeder.details.diseaseType;
        document.getElementById("diagnosis_treatment").value = breeder.details.treatment;
        document.getElementById("diagnosis_date").value = breeder.details.diagnosisDate;
        document.getElementById("diagnosis_nextAppointment").value = breeder.details.nextAppointment;
      }
      else if (breeder.fieldWorkType === "ولادة" && breeder.details) {
        document.getElementById("delivery_animalType").value = breeder.details.animalType;
        document.getElementById("delivery_date").value = breeder.details.deliveryDate;
        document.getElementById("delivery_type").value = breeder.details.deliveryType;
        document.getElementById("delivery_treatment").value = breeder.details.treatment;
        document.getElementById("delivery_nextAppointment").value = breeder.details.nextAppointment;
      }
      breeders.splice(index, 1);
      localStorage.setItem("breeders_" + localStorage.getItem("username"), JSON.stringify(breeders));
      showSection("main");
    }

    function searchBreeders() {
      let query = document.getElementById("search").value.toLowerCase();
      let recordsList = document.getElementById("records-list");
      recordsList.innerHTML = "";
      breeders.forEach((breeder, index) => {
        if (breeder.name.toLowerCase().includes(query) || (breeder.fieldWorkType && breeder.fieldWorkType.toLowerCase().includes(query))) {
          let nextApp = (breeder.details && breeder.details.nextAppointment) ? breeder.details.nextAppointment : "";
          let remainingTime = nextApp ? calculateRemainingTime(nextApp) : "";
          let recordDiv = document.createElement("div");
          recordDiv.className = "record";
          recordDiv.innerHTML = `
            ${breeder.name} - النوع: ${breeder.fieldWorkType} - الموعد القادم: ${remainingTime}
            <button class="edit-btn" onclick="editBreeder(${index}); event.stopPropagation();">تعديل</button>
            <button class="delete-btn" onclick="deleteBreeder(${index}); event.stopPropagation();">حذف</button>
          `;
          recordDiv.onclick = function() {
            showBreederDetail(index);
          };
          recordsList.appendChild(recordDiv);
        }
      });
    }

    function showAdminPanel() {
      let accountsList = document.getElementById("accounts-list");
      accountsList.innerHTML = "";
      for (let i = 0; i < localStorage.length; i++) {
        let key = localStorage.key(i);
        if (key.startsWith("account_") || key === "account_owner") {
          let accountRaw = localStorage.getItem(key);
          let account = JSON.parse(accountRaw);
          if (account.banned) continue;
          let div = document.createElement("div");
          div.className = "record";
          let innerHTML = `
            ${account.username}
            <button class="details-btn" onclick="toggleAccountDetails('${key}', this.parentElement)">عرض التفاصيل</button>
          `;
          if (account.username !== "admin" && account.username !== "محمد بن علي") {
            innerHTML += `<button class="delete-btn" onclick="banUser('${key}')">تبنيد المستخدم</button>`;
          }
          div.innerHTML = innerHTML;
          accountsList.appendChild(div);
        }
      }
    }

    function toggleAccountDetails(key, div) {
      let detailsDiv = document.getElementById(`account-details-${key}`);
      if (detailsDiv) {
        detailsDiv.remove();
      } else {
        let accountRaw = localStorage.getItem(key);
        let account = JSON.parse(accountRaw);
        let details = document.createElement("div");
        details.id = `account-details-${key}`;
        details.innerHTML = `
          <p>البريد الإلكتروني: ${account.email}</p>
          <p>كلمة المرور: ${account.password}</p>
          <p>موعد إنشاء الحساب: ${account.createdAt}</p>
          <button class="hide-btn" onclick="toggleAccountDetails('${key}', this.parentElement.parentElement)">إخفاء التفاصيل</button>
        `;
        div.appendChild(details);
      }
    }

    function banUser(key) {
      let accountRaw = localStorage.getItem(key);
      let account = JSON.parse(accountRaw);
      if (account.username === "admin" || account.username === "محمد بن علي") {
        alert("لا يمكن تبنيد هذا الحساب");
        return;
      }
      let reason = prompt("أدخل سبب التبنيد:");
      if (reason) {
        account.banned = true;
        account.banReason = reason;
        localStorage.setItem(key, JSON.stringify(account));
        alert("تم تبنيد المستخدم " + account.username);
        showAdminPanel();
      }
    }

    function logout() {
      if (confirm("متأكد من تسجيل الخروج؟")) {
        localStorage.removeItem("username");
        showSection("login");
        alert("تم تسجيل الخروج");
      }
    }

    window.onload = function() {
      if (localStorage.getItem("username")) {
        updateWelcome();
        let username = localStorage.getItem("username");
        breeders = JSON.parse(localStorage.getItem("breeders_" + username)) || [];
        showSection("main");
      } else {
        showSection("login");
      }
      showBreeders();
    }
  </script>

  <p style="margin-top:30px; font-size:12px;">تم صنع الموقع بواسطة الدكتور علي بلال</p>
</body>
</html>